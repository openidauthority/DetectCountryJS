// Timezones updated July 2020

function getUsersCountry(fallback) {
	return getCountryFromTimezone(Intl.DateTimeFormat().resolvedOptions().timeZone, fallback);
}

function getCountryFromTimezone(tz, fallback) {
	if(typeof tz !== 'string') {
		return falback;
	}
	const tzs = {"Africa":{"Abidjan":"CI","Accra":"GH","Addis_Ababa":"ET","Algiers":"DZ","Asmara":"ER","Bamako":"ML","Bangui":"CF","Banjul":"GM","Bissau":"GW","Blantyre":"MW","Brazzaville":"CG","Bujumbura":"BI","Cairo":"EG","Casablanca":"MA","Ceuta":"ES","Conakry":"GN","Dakar":"SN","Dar_es_Salaam":"TZ","Djibouti":"DJ","Douala":"CM","El_Aaiun":"EH","Freetown":"SL","Gaborone":"BW","Harare":"ZW","Johannesburg":"ZA","Juba":"SS","Kampala":"UG","Khartoum":"SD","Kigali":"RW","Kinshasa":"CD","Lagos":"NG","Libreville":"GA","Lome":"TG","Luanda":"AO","Lubumbashi":"CD","Lusaka":"ZM","Malabo":"GQ","Maputo":"MZ","Maseru":"LS","Mbabane":"SZ","Mogadishu":"SO","Monrovia":"LR","Nairobi":"KE","Ndjamena":"TD","Niamey":"NE","Nouakchott":"MR","Ouagadougou":"BF","Porto-Novo":"BJ","Sao_Tome":"ST","Timbuktu":"ML","Tripoli":"LY","Tunis":"TN","Windhoek":"NA"},"America":{"Adak":"US","Anchorage":"US","Anguilla":"AI","Antigua":"AG","Araguaina":"BR","Argentina":{"Buenos_Aires":"AR","Catamarca":"AR","ComodRivadavia":"AR","Cordoba":"AR","Jujuy":"AR","La_Rioja":"AR","Mendoza":"AR","Rio_Gallegos":"AR","Salta":"AR","San_Juan":"AR","San_Luis":"AR","Tucuman":"AR","Ushuaia":"AR"},"Aruba":"AW","Asuncion":"PY","Atikokan":"CA","Atka":"US","Bahia":"BR","Bahia_Banderas":"MX","Barbados":"BB","Belem":"BR","Belize":"BZ","Blanc-Sablon":"CA","Boa_Vista":"BR","Bogota":"CO","Boise":"US","Buenos_Aires":"AR","Cambridge_Bay":"CA","Campo_Grande":"BR","Cancun":"MX","Caracas":"VE","Catamarca":"AR","Cayenne":"GF","Cayman":"KY","Chicago":"US","Chihuahua":"MX","Coral_Harbour":"CA","Cordoba":"AR","Costa_Rica":"CR","Creston":"CA","Cuiaba":"BR","Curacao":"CW","Danmarkshavn":"GL","Dawson":"CA","Dawson_Creek":"CA","Denver":"US","Detroit":"US","Dominica":"DM","Edmonton":"CA","Eirunepe":"BR","El_Salvador":"SV","Ensenada":"MX","Fort_Nelson":"CA","Fort_Wayne":"US","Fortaleza":"BR","Glace_Bay":"CA","Godthab":"GL","Goose_Bay":"CA","Grand_Turk":"TC","Grenada":"GD","Guadeloupe":"GP","Guatemala":"GT","Guayaquil":"EC","Guyana":"GY","Halifax":"CA","Havana":"CU","Hermosillo":"MX","Indiana":{"Indianapolis":"US","Knox":"US","Marengo":"US","Petersburg":"US","Tell_City":"US","Vevay":"US","Vincennes":"US","Winamac":"US"},"Indianapolis":"US","Inuvik":"CA","Iqaluit":"CA","Jamaica":"JM","Jujuy":"AR","Juneau":"US","Kentucky":{"Louisville":"US","Monticello":"US"},"Knox_IN":"US","Kralendijk":"BQ","La_Paz":"BO","Lima":"PE","Los_Angeles":"US","Louisville":"US","Lower_Princes":"SX","Maceio":"BR","Managua":"NI","Manaus":"BR","Marigot":"MF","Martinique":"MQ","Matamoros":"MX","Mazatlan":"MX","Mendoza":"AR","Menominee":"US","Merida":"MX","Metlakatla":"US","Mexico_City":"MX","Miquelon":"PM","Moncton":"CA","Monterrey":"MX","Montevideo":"UY","Montreal":"CA","Montserrat":"MS","Nassau":"BS","New_York":"US","Nipigon":"CA","Nome":"US","Noronha":"BR","North_Dakota":{"Beulah":"US","Center":"US","New_Salem":"US"},"Ojinaga":"MX","Panama":"PA","Pangnirtung":"CA","Paramaribo":"SR","Phoenix":"US","Port_of_Spain":"TT","Port-au-Prince":"HT","Porto_Acre":"BR","Porto_Velho":"BR","Puerto_Rico":"PR","Punta_Arenas":"CL","Rainy_River":"CA","Rankin_Inlet":"CA","Recife":"BR","Regina":"CA","Resolute":"CA","Rio_Branco":"BR","Rosario":"AR","Santa_Isabel":"PR","Santarem":"BR","Santiago":"CL","Santo_Domingo":"DO","Sao_Paulo":"BR","Scoresbysund":"GL","Shiprock":"US","Sitka":"US","St_Barthelemy":"BL","St_Johns":"CA","St_Kitts":"KN","St_Lucia":"LC","St_Thomas":"VI","St_Vincent":"VC","Swift_Current":"CA","Tegucigalpa":"HN","Thule":"GL","Thunder_Bay":"CA","Tijuana":"MX","Toronto":"CA","Tortola":"VG","Vancouver":"CA","Virgin":"US","Whitehorse":"CA","Winnipeg":"CA","Yakutat":"US","Yellowknife":"CA"},"Antarctica":{"Casey":"AQ","Davis":"AQ","DumontDUrville":"AQ","Macquarie":"AU","Mawson":"AQ","McMurdo":"AQ","Palmer":"AQ","Rothera":"AQ","South_Pole":"AQ","Syowa":"AQ","Troll":"AQ","Vostok":"AQ"},"Arctic":{"Longyearbyen":"SJ"},"Asia":{"Aden":"YE","Almaty":"KZ","Amman":"JO","Anadyr":"RU","Aqtau":"KZ","Aqtobe":"KZ","Ashgabat":"TM","Ashkhabad":"TM","Atyrau":"KZ","Baghdad":"IQ","Bahrain":"BH","Baku":"AZ","Bangkok":"TH","Barnaul":"RU","Beirut":"LB","Bishkek":"KG","Brunei":"BN","Calcutta":"IN","Chita":"RU","Choibalsan":"MN","Chongqing":"CN","Chungking":"CN","Colombo":"LK","Dacca":"BD","Damascus":"SY","Dhaka":"BD","Dili":"TL","Dubai":"AE","Dushanbe":"TJ","Famagusta":"CY","Gaza":"PS","Harbin":"CN","Hebron":"PS","Ho_Chi_Minh":"VN","Hong_Kong":"HK","Hovd":"MN","Irkutsk":"RU","Istanbul":"TR","Jakarta":"ID","Jayapura":"ID","Jerusalem":"IL","Kabul":"AF","Kamchatka":"RU","Karachi":"PK","Kashgar":"CN","Kathmandu":"NP","Katmandu":"NP","Khandyga":"RU","Kolkata":"IN","Krasnoyarsk":"RU","Kuala_Lumpur":"MY","Kuching":"MY","Kuwait":"KW","Macao":"MO","Macau":"MO","Magadan":"RU","Makassar":"ID","Manila":"PH","Muscat":"OM","Nicosia":"CY","Novokuznetsk":"RU","Novosibirsk":"RU","Omsk":"RU","Oral":"KZ","Phnom_Penh":"KH","Pontianak":"ID","Pyongyang":"KP","Qatar":"QA","Qyzylorda":"KZ","Rangoon":"MM","Riyadh":"SA","Saigon":"VN","Sakhalin":"RU","Samarkand":"UZ","Seoul":"KR","Shanghai":"CN","Singapore":"SG","Srednekolymsk":"RU","Taipei":"TW","Tashkent":"UZ","Tbilisi":"GE","Tehran":"IR","Tel_Aviv":"IL","Thimbu":"BT","Thimphu":"BT","Tokyo":"JP","Tomsk":"RU","Ujung_Pandang":"ID","Ulaanbaatar":"MN","Ulan_Bator":"MN","Urumqi":"CN","Ust-Nera":"RU","Vientiane":"LA","Vladivostok":"RU","Yakutsk":"RU","Yangon":"MM","Yekaterinburg":"RU","Yerevan":"AM"},"Atlantic":{"Azores":"PT","Bermuda":"BM","Canary":"ES","Cape_Verde":"CV","Faeroe":"FO","Faroe":"FO","Jan_Mayen":"SJ","Madeira":"PT","Reykjavik":"IS","South_Georgia":"GS","St_Helena":"SH","Stanley":"FK"},"Australia":{"Adelaide":"AU","Brisbane":"AU","Broken_Hill":"AU","Canberra":"AU","Currie":"AU","Darwin":"AU","Eucla":"AU","Hobart":"AU","Lindeman":"AU","Lord_Howe":"AU","Melbourne":"AU","Perth":"AU","Sydney":"AU","Yancowinna":"AU"},"Europe":{"Amsterdam":"NL","Andorra":"AD","Astrakhan":"RU","Athens":"GR","Belfast":"UK","Belgrade":"RS","Berlin":"DE","Bratislava":"SK","Brussels":"BE","Bucharest":"RO","Budapest":"HU","Busingen":"DE","Chisinau":"MD","Copenhagen":"DK","Dublin":"IE","Gibraltar":"GI","Guernsey":"GG","Helsinki":"FI","Isle_of_Man":"IM","Istanbul":"TR","Jersey":"JE","Kaliningrad":"RU","Kiev":"UA","Kirov":"RU","Lisbon":"PT","Ljubljana":"SI","London":"GB","Luxembourg":"LU","Madrid":"ES","Malta":"MT","Mariehamn":"AX","Minsk":"BY","Monaco":"MC","Moscow":"RU","Oslo":"NO","Paris":"FR","Podgorica":"ME","Prague":"CZ","Riga":"LV","Rome":"IT","Samara":"RU","San_Marino":"SM","Sarajevo":"BA","Saratov":"RU","Simferopol":"UA","Skopje":"MK","Sofia":"BG","Stockholm":"SE","Tallinn":"EE","Tirane":"AL","Tiraspol":"MD","Ulyanovsk":"RU","Uzhgorod":"UA","Vaduz":"LI","Vatican":"VA","Vienna":"AT","Vilnius":"LT","Volgograd":"RU","Warsaw":"PL","Zagreb":"HR","Zaporozhye":"UA","Zurich":"CH"},"Indian":{"Antananarivo":"MG","Chagos":"IO","Christmas":"CX","Cocos":"CC","Comoro":"KM","Kerguelen":"TF","Mahe":"SC","Maldives":"MV","Mauritius":"MU","Mayotte":"YT","Reunion":"RE"},"Pacific":{"Apia":"WS","Auckland":"NZ","Bougainville":"PG","Chatham":"NZ","Chuuk":"FM","Easter":"CL","Efate":"VU","Enderbury":"KI","Fakaofo":"TK","Fiji":"FJ","Funafuti":"TV","Galapagos":"EC","Gambier":"PF","Guadalcanal":"SB","Guam":"GU","Honolulu":"US","Johnston":"UM","Kiritimati":"KI","Kosrae":"FM","Kwajalein":"MH","Majuro":"MH","Marquesas":"PF","Midway":"UM","Nauru":"NR","Niue":"NU","Norfolk":"NF","Noumea":"NC","Pago_Pago":"AS","Palau":"PW","Pitcairn":"PN","Pohnpei":"FM","Ponape":"FM","Port_Moresby":"PG","Rarotonga":"CK","Saipan":"MP","Samoa":"WS","Tahiti":"PF","Tarawa":"KI","Tongatapu":"TO","Truk":"FM","Wake":"UM","Wallis":"WF","Yap":"FM"}};
	
	let branch = tzs;
	let parts = tz.split('/');
	for(let i = 0; i < parts.length; i++) {
		if(!branch.hasOwnProperty(parts[i])) {
			return fallback;
		}
		branch = branch[parts[i]];
	}
	return branch;
}
